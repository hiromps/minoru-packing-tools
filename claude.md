# ミノルキューブ最適配送システム要件定義書

## プロジェクト概要

### システム名
ミノルキューブ最適配送システム（Minoru-packing-tools）

### 開発ツール
Claude Code

### 目的
1. **送料最適化**: サイズの異なるミノルキューブ商品群を混載発送する際の最適な輸送箱を提案し、送料を低減する
2. **作業効率向上**: 輸送箱内での商品の最適な詰め方を提案し、梱包作業の効率を向上させる

### 重要
- コードを追加・変更を行った際は必ずチェックリスト.mdに✅チェックをつけて進捗管理をするように

## 機能要件

### 1. 商品情報入力機能
#### 1.1 手動入力（Phase 1）
- **入力項目**: 
  - Sサイズ: 個数
  - Sロングサイズ: 個数
  - Lサイズ: 個数  
  - Lロングサイズ: 個数
  - LLサイズ: 個数
- **UI**: シンプルなフォーム形式
- **バリデーション**: 正の整数のみ受付

#### 1.2 画像入力（Phase 2 - Better機能）
- **入力方法**: 発送前商品の撮影画像をアップロード
- **処理**: 画像認識による商品サイズ・数量の自動判定
- **フォールバック**: 認識失敗時は手動入力へ誘導

### 2. 最適輸送箱提案機能
#### 2.1 箱サイズ計算
- **入力**: 商品リスト（サイズ別数量）
- **処理**: 
  - 全商品が収納可能な輸送箱の組み合わせを算出
  - 送料を考慮した最適解を提案
- **出力**: 
  - 推奨輸送箱（サイズ、型番）
  - 予想送料
  - 代替案（複数箱に分割する場合など）

#### 2.2 送料比較機能
- **機能**: 複数の輸送箱候補での送料比較
- **表示**: 送料差額、節約効果の明示

### 3. 商品配置最適化機能
#### 3.1 3Dパッキング計算
- **アルゴリズム**: 3Dビンパッキング問題の解法実装
- **考慮要素**:
  - 商品の向き（回転可能性）
  - 重量分散
  - 取り出しやすさ
  - 破損リスク最小化

#### 3.2 配置図表示
- **2D図**: 上面図、側面図での配置パターン表示
- **3D図**: 可能であれば3D表示で直感的な理解促進
- **手順**: ステップバイステップの梱包手順

## データ仕様

### 1. 輸送箱マスタ
```
transport_boxes = {
  "No.": string,      // 箱の型番
  "w": number,        // 幅(cm)
  "d": number,        // 奥行(cm) 
  "h": number,        // 高さ(cm)
  "max_weight": number // 最大積載重量(kg)
}
```

### 2. 製品マスタ
```
products = {
  "size": string,     // サイズ名(S, Sロング, L, Lロング, LL)
  "w": number,        // 幅(cm)
  "d": number,        // 奥行(cm)
  "h": number,        // 高さ(cm)
  "weight": number    // 重量(kg)
}
```

### 3. 運賃マスタ
```
shipping_rates = {
  "carrier": string,  // 運送業者名
  "size": string,     // 輸送箱サイズ区分
  "rate": number      // 送料(円)
}
```

## 技術要件

### 1. プログラミング言語
- **Primary**: Python
- **理由**: 数値計算ライブラリが豊富、3Dパッキングアルゴリズムの実装に適している

### 2. 主要ライブラリ
- **数値計算**: NumPy, SciPy
- **最適化**: OR-Tools（Googleの最適化ライブラリ）
- **3D計算**: py3dbp（3D Bin Packing）
- **データ処理**: Pandas
- **UI**: Streamlit（Webアプリケーション化する場合）

### 3. アルゴリズム
- **ビンパッキング**: First Fit Decreasing (FFD) または Best Fit Decreasing (BFD)
- **最適化**: 遺伝的アルゴリズムまたは制約充足問題（CSP）として解法

## システム構成

### 1. コアモジュール
```
src/
├── core/
│   ├── packing_optimizer.py    # パッキング最適化エンジン
│   ├── shipping_calculator.py  # 送料計算エンジン
│   └── box_selector.py         # 最適箱選択ロジック
├── data/
│   ├── products.py             # 製品マスタ
│   ├── boxes.py                # 輸送箱マスタ
│   └── rates.py                # 運賃マスタ
├── ui/
│   ├── input_handler.py        # 入力処理
│   └── output_renderer.py      # 結果表示
└── main.py                     # メインアプリケーション
```

### 2. データフロー
1. **入力**: 商品リスト（サイズ別数量）
2. **箱選択**: 可能な輸送箱の抽出
3. **パッキング計算**: 各箱での最適配置計算
4. **送料計算**: 各パターンでの送料算出
5. **最適解選択**: 送料・効率を総合した最適解の決定
6. **出力**: 推奨箱、配置図、送料情報

## 開発フェーズ

### Phase 1: MVP（最小viable product）
- [ ] 基本的な手動入力機能
- [ ] シンプルなパッキング計算
- [ ] 送料計算機能
- [ ] テキストベースの結果表示

### Phase 2: 機能拡張
- [ ] 画像入力機能
- [ ] 3D可視化
- [ ] 複数運送業者対応
- [ ] 詳細な配置手順表示

### Phase 3: 最適化
- [ ] アルゴリズムの高速化
- [ ] UIの改善
- [ ] 実運用での調整・チューニング

## 成功指標

### 1. 機能面
- [ ] 送料削減率: 平均10%以上の送料削減を実現
- [ ] 処理速度: 1秒以内での最適解提案
- [ ] 精度: パッキング成功率95%以上

### 2. 運用面
- [ ] 梱包作業時間: 従来比20%短縮
- [ ] 操作習得: 新規ユーザーが5分以内に操作を習得可能
- [ ] エラー率: 梱包ミス発生率5%以下

## 想定される課題と対策

### 1. 技術的課題
- **3Dパッキングの計算複雑性**: ヒューリスティック手法の採用で実用的な速度を確保
- **商品の向き制約**: 製品特性に応じた回転可否設定の実装

### 2. 運用課題
- **不規則な商品形状**: 代表的なケースでのテスト・調整
- **季節変動**: 送料体系変更への柔軟な対応

## 今後の拡張可能性

1. **他商品への対応**: ミノルキューブ以外の商品への適用
2. **在庫連携**: 在庫管理システムとの連携
3. **配送計画**: 複数顧客への同時配送最適化
4. **コスト分析**: 詳細なコスト分析・レポート機能