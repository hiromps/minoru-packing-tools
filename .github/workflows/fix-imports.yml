name: Fix Streamlit Import Issues

on:
workflow_dispatch:
push:
branches: [ main, master ]

permissions:
contents: write
pull-requests: write

jobs:
fix-imports:
runs-on: ubuntu-latest

```
steps:
- name: Checkout repository
  uses: actions/checkout@v4
  with:
    fetch-depth: 0
    token: ${{ secrets.GITHUB_TOKEN }}

- name: Setup Python
  uses: actions/setup-python@v4
  with:
    python-version: '3.11'

- name: Create init files
  run: |
    echo "Creating __init__.py files..."
    
    # srcé…ä¸‹ã«__init__.pyã‚’ä½œæˆ
    mkdir -p src/ui src/core src/data
    touch src/__init__.py
    touch src/ui/__init__.py
    touch src/core/__init__.py
    touch src/data/__init__.py
    
    echo "âœ… Created __init__.py files"

- name: Fix main production file
  run: |
    echo "Fixing main_production.py..."
    
    # main_production.pyãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ä¿®æ­£
    if [ -f "src/main_production.py" ]; then
      # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
      cp src/main_production.py src/main_production.py.bak
      
      # æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
      cat > src/main_production.py << 'EOF'
    # ãƒ‘ã‚¹è¨­å®š
    import sys
    import os
    from pathlib import Path
    
    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’ãƒ‘ã‚¹ã«è¿½åŠ 
    current_dir = Path(__file__).parent.parent
    sys.path.insert(0, str(current_dir))
    
    EOF
      
      # å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ï¼ˆimportè¡Œä»¥å¤–ï¼‰
      grep -v "^from src\." src/main_production.py.bak >> src/main_production.py || true
      
      echo "âœ… Fixed main_production.py"
    else
      echo "âš ï¸ main_production.py not found"
    fi

- name: Update requirements
  run: |
    echo "Updating requirements.txt..."
    
    cat > requirements.txt << 'EOF'
    streamlit>=1.30.0
    numpy>=1.25.0
    pandas>=2.0.0
    plotly>=5.15.0
    matplotlib>=3.7.0
    ortools>=9.8.0
    setuptools>=68.0.0
    packaging>=21.0
    EOF
    
    echo "âœ… Updated requirements.txt"

- name: Create runtime file
  run: |
    echo "python-3.11" > runtime.txt
    echo "âœ… Created runtime.txt"

- name: Create streamlit config
  run: |
    mkdir -p .streamlit
    cat > .streamlit/config.toml << 'EOF'
    [server]
    headless = true
    port = 8501
    
    [theme]
    base = "light"
    EOF
    echo "âœ… Created Streamlit config"

- name: Commit changes
  run: |
    git config --local user.email "action@github.com"
    git config --local user.name "GitHub Action Bot"
    
    git add .
    
    # å¤‰æ›´ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if git diff --staged --quiet; then
      echo "No changes to commit"
    else
      git commit -m "ðŸ”§ Fix Python imports and update dependencies for Streamlit"
      git push origin ${{ github.ref_name }}
      echo "âœ… Changes committed and pushed"
    fi
```